{% extends "base.html" %}

{% block title %}Catálogo de Endereços{% endblock %}

{% block page_title %}
<div class="page-header">
    <h1><i class="fas fa-address-book me-2"></i>Catálogo de Endereços</h1>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary">
        <i class="fas fa-sign-out-alt me-2"></i>Sair ({{ session.get('user_display_name', 'Usuário') }})
    </a>
</div>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <input type="text" id="search-input" class="form-control form-control-lg" placeholder="Buscar por nome, cargo, departamento, empresa ou localidade...">
    </div>
</div>

<div class="row" id="user-cards-container">
    {% for user in users %}
    <div class="col-md-6 col-lg-4 mb-4 user-card-wrapper">
        <div class="card glass-card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ user.displayName[0] }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ user.title[0] if user.title else 'N/A' }}</h6>
                <hr>
                <p class="card-text mb-1"><i class="fas fa-building me-2 text-muted"></i>{{ user.department[0] if user.department else 'N/A' }}</p>
                <p class="card-text mb-1"><i class="fas fa-briefcase me-2 text-muted"></i>{{ user.company[0] if user.company else 'N/A' }}</p>
                <p class="card-text mb-1"><i class="fas fa-map-marker-alt me-2 text-muted"></i>{{ user.l[0] if user.l else 'N/A' }}</p>
                <p class="card-text mb-1"><i class="fas fa-phone me-2 text-muted"></i>{{ user.telephoneNumber[0] if user.telephoneNumber else 'N/A' }}</p>
                <p class="card-text mb-1"><i class="fas fa-envelope me-2 text-muted"></i><a href="mailto:{{ user.mail[0] }}">{{ user.mail[0] }}</a></p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col">
        <div class="alert alert-info">
            <p class="mb-0">Nenhum usuário encontrado no catálogo.</p>
            <p class="mb-0 small">Lembre-se: Apenas usuários com todos os campos essenciais (nome, cargo, departamento, telefone, e-mail, empresa e localidade) preenchidos no Active Directory são exibidos aqui.</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const container = document.getElementById('user-cards-container');
    const userCards = Array.from(container.getElementsByClassName('user-card-wrapper'));

    searchInput.addEventListener('keyup', function() {
        const query = searchInput.value.toLowerCase().trim();

        userCards.forEach(card => {
            const cardText = card.textContent.toLowerCase();
            if (cardText.includes(query)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}