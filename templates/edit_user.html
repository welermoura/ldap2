{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %}

{% block title %}Editar {{ user_name }} - Gestão AD{% endblock %}

{% from "_macros.html" import render_page_header %}

{% block page_title %}
    {% set title_text = '<i class="fas fa-edit me-2"></i>Editar Usuário: ' ~ user_name %}
    {{ render_page_header(title_text) }}
{% endblock %}

{% block content %}
{% set tabs = {
    'Geral': ['first_name', 'initials', 'last_name', 'display_name', 'description', 'office', 'email', 'web_page'],
    'Endereço': ['street', 'post_office_box', 'city', 'state', 'zip_code'],
    'Telefones': ['telephone', 'home_phone', 'pager', 'mobile', 'fax'],
    'Organização': ['title', 'department', 'company']
} %}

<div class="card glass-card">
    <form method="POST" action="{{ url_for('edit_user', username=username) }}">
        {{ form.hidden_tag() }}

        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="edit-user-tabs" role="tablist">
                {% for tab_name in tabs.keys() %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if loop.first %}active{% endif %}" id="{{ tab_name|lower }}-tab" data-bs-toggle="tab" data-bs-target="#{{ tab_name|lower }}" type="button" role="tab">{{ tab_name }}</button>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="card-body">
            <div class="tab-content" id="edit-user-content">
                {% for tab_name, tab_fields in tabs.items() %}
                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="{{ tab_name|lower }}" role="tabpanel">
                    <div class="row p-3">
                        {% for field_name in tab_fields %}
                        {% set field = form[field_name] %}
                        <div class="col-md-6 mb-3 {% if field_name in editable_fields %}is-editable{% endif %}">
                            {{ render_field(field, disabled=(field_name not in editable_fields)) }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="card-footer text-end">
                {% if not editable_fields %}
                <div class="alert alert-warning text-start">
                    <i class="fas fa-exclamation-triangle me-2"></i>Você não tem permissão para editar nenhum campo deste usuário.
                </div>
                {% else %}
                <input type="submit" value="Salvar Alterações" class="btn btn-primary btn-lg">
                {% endif %}
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<style>
/* Custom styles for glass tabs */
.nav-tabs .nav-link {
    background-color: transparent;
    border: none;
    color: var(--text-muted-color);
    transition: color 0.2s ease-in-out, background-color 0.2s ease-in-out;
}
.nav-tabs .nav-link.active {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: transparent;
    color: #fff;
}
.nav-tabs .nav-link:hover {
    color: #fff;
}
.nav-tabs {
    border-bottom: 1px solid var(--glass-border-color);
}
.card-footer {
    background-color: transparent;
    border-top: 1px solid var(--glass-border-color);
}
</style>
{% endblock %}